{% element 'schema' { 'product' : product } %}

{% if ProgressiveDiscounts %}
    <div class="pageProduct-bannerDiscount">
        {% for discount in ProgressiveDiscounts %}
            {% if discount.banner %}
                <img class="bannerDiscount-image" src="{{ discount.banner }}" alt="{{ discount.name }}"/>
            {% endif %}
        {% endfor %}
    </div>
{% endif %}

<div class="pageProduct" id="page-product">
    <div class="pageProduct-main">
        {% set discount = product.price_offer > 0 ? (100 - (product.price_offer / product.price) * 100) : false %}

        {% element 'snippets/image-gallery' {'product_images': product.images, 'product_video': product.video,'product_name': product.name } %}

        <section class="pageProduct-info">
            {% element 'snippets/breadcrumb' %}

            <div class="pageProduct-loader loader">
                <div class="spinner">
                    <div class="double-bounce-one"></div>
                    <div class="double-bounce-two"></div>
                </div>
                <div class="message">Atualizando informa&ccedil;&otilde;es ...</div>
            </div>

            {% if productHelper.banner() %}
                {% set batch_promotion = productHelper.banner() %}
                <div class="pageProduct-batchPromotion {{ ('img' not in batch_promotion) ? 'text-promotion' : '' }}">
                    {{ batch_promotion }}
                </div>
            {% endif %}

            <div class="pageProduct-nameAndInformation {{ batch_promotion ? 'u-width' : '' }}">

                <div class="pageProduct-containerTitle">
                    <h1 class="pageProduct-name">{{ product.name }}</h1>
                    {% if not product.upon_request and product.available and productHelper.wishlist() %}
                        <div class="pageProduct-wishlist tray-hide" data-logged-user="true">
                            <button class="pageProduct-wishlist" type="button" title="Adicionar a Lista de Desejos">
                                <svg width="20" height="18" viewBox="0 0 30 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8.33317 1C4.65184 1 1.6665 3.95467 1.6665 7.6C1.6665 10.5427 2.83317 17.5267 14.3172 24.5867C14.5229 24.7118 14.759 24.778 14.9998 24.778C15.2406 24.778 15.4768 24.7118 15.6825 24.5867C27.1665 17.5267 28.3332 10.5427 28.3332 7.6C28.3332 3.95467 25.3478 1 21.6665 1C17.9852 1 14.9998 5 14.9998 5C14.9998 5 12.0145 1 8.33317 1Z" fill="#D9D9D9" stroke="#595867" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                {{ productHelper.wishlist() }}
                            </button>
                        </div>
                        <div class="pageProduct-wishlist tray-hide" data-logged-user="false">
                            <a class="pageProduct-wishlist" href="{{ links.login }}" title="Adicionar a Lista de Desejos">
                                <svg width="20" height="18" viewBox="0 0 30 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8.33317 1C4.65184 1 1.6665 3.95467 1.6665 7.6C1.6665 10.5427 2.83317 17.5267 14.3172 24.5867C14.5229 24.7118 14.759 24.778 14.9998 24.778C15.2406 24.778 15.4768 24.7118 15.6825 24.5867C27.1665 17.5267 28.3332 10.5427 28.3332 7.6C28.3332 3.95467 25.3478 1 21.6665 1C17.9852 1 14.9998 5 14.9998 5C14.9998 5 12.0145 1 8.33317 1Z" fill="#D9D9D9" stroke="#595867" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </a>
                        </div>
                    {% endif %}
                </div>


                {% if (product.reference and settings.show_reference) or (settings.show_product_brand and product.brand) or (settings.show_reference) %}
                    <div class="pageProduct-subtitle">
                        {% if settings.show_product_stock and product.stock %}
                            <p class="information-text stock">
                                Estoque: {{ product.stock }}
                            </p>
                        {% endif %}

                        {% if product.reference and settings.show_reference %}
                            <div class="subtitle-detail sku">
                                Refer&ecirc;ncia:
                                <span class="product-sku ref" id="product-reference" data-url="/mvc/store/product/variant_reference/?loja={{ store.id }}">{{ product.reference }}</span>
                            </div>
                        {% endif %}

                        {% if product.model %}
                            <div class="subtitle-detail model">Modelo: {{ product.model }}</div>
                        {% endif %}

                        {% if settings.show_release_date is not empty %}
                            <div class="subtitle-detail release">{{ settings.new_release_title }} : {{ product.release_date|date('d/m/Y') }}</div>
                        {% endif %}

                    </div>
                {% endif %}

                {% if bannerImg %}<div class="pageProduct-wrapper">{% endif %}

                {% if bannerImg %}<div class="pageProduct-wrapper-info">{% endif %}

                {% set lastProgressiveDiscount = ProgressiveDiscounts | last %}

                {% if product.featured or product.free_shipping or product.new or extra_tag or discount %}

                    <div class="pageProduct-tags">
                        {% set replaceTags = {'src=': 'height="26px" alt="Selo" src='} %}
                        {% if product.featured %}
                            <div class="tag-featured tag">
                                {% if Image('featured') %}
                                    {{ Image('featured') | replace(replaceTags) }}
                                {% else %}
                                    <div>
                                        Destaque
                                    </div>
                                {% endif %}
                            </div>
                        {% endif %}

                        {% if product.free_shipping %}
                            <div class="tag-freeShipping tag">
                                {% if Image('free_shipping') %}
                                    {{ Image('free_shipping') | replace(replaceTags) }}
                                {% else %}
                                    <div>
                                        Frete gr&aacute;tis
                                    </div>
                                {% endif %}
                            </div>
                        {% endif %}

                        {% if product.new %}
                            <div class="tag-new tag">
                                {% if Image('new') %}
                                    {{ Image('new') | replace(replaceTags) }}
                                {% else %}
                                    <div>
                                        Lan&ccedil;amento
                                    </div>
                                {% endif %}
                            </div>
                        {% endif %}

                        {% if Image('additional_button') %}
                            <div class="tag-extra tag">{{ Image('additional_button') | replace(replaceTags) }}</div>
                        {% endif %}

                    </div>
                {% endif %}

                </div>

                {% if product.available and (product.stock > 0 or settings.without_stock_sale) and not product.upon_request %}
                    <form id="form_comprar" class=" pageProduct-form {{ form_classes | length > 0 ? form_classes | join (' ') : '' }}" method="post" data-app="product.buy-form" data-id="{{ product.id }}" action="{{ links.cart_add ~ product.id }}">
                        {% if settings.hide_price %}
                            <div class="btnRowProduct" data-price-hidden="false">
                                <p><a class="btnProductLogin" href="/my-account/login">Login para ver os preços</a></p>
                            </div>
                        {% endif %}

                        {% if not settings.hide_price %}
                            <div data-price-hidden="{{settings.hide_price ? 'true' : 'false'}}" class="pageProduct-price serverTray-content">
                                {{ productHelper.pricing() }}
                            </div>
                        {% endif %}

                        {% if productHelper.bonus() and 'idBonusVariacao' in productHelper.bonus() %}
                            <div class="pageProduct-bonusScore">{{ productHelper.bonus() }}</div>
                        {% endif %}

                        {% set form_classes = [] %}
                        {% if product.is_kit %}
                            {% set form_classes = form_classes | merge(['is-kit']) %}
                        {% endif %}
                        {% if productHelper.gifts() %}
                            {% set form_classes = form_classes | merge(['has-gift']) %}
                        {% endif %}
                        {% set productDetails = productHelper.details() %}

                        {% if product.variants %}
                            <div class="pageProduct-variants openScope openScopeKit" data-price-hidden="{{settings.hide_price ? 'true' : 'false'}}" data-has-variations>
                                <div class="variants-choice serverTray-content">{{ productHelper.variants() }}</div>
                            </div>
                        {% endif %}

                        {% if product.additional_message %}
                        <p class="pageProduct-additionalMessage">{{ product.additional_message }}</p>
                        {% endif %}

                        {% element 'snippets/body-measurement' { 'product' : product } %}

                        {% if ProgressiveDiscounts %}
                            <div class="pageProduct-progressiveDiscount">
                                <p class="progressiveDiscount-text">Produto com desconto progressivo</p>
                                <ul class="progressiveDiscount-list">
                                    {% for discount in ProgressiveDiscounts %}
                                        <li class="progressiveDiscount-item" data-name="{{ discount.name }}">
                                            {{ discount.description }}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% if ProgressiveDiscounts|length > 1 %}
                                <p class="progressiveDiscount-alert">
                                    <b>Aten&ccedil;&atilde;o!</b> Somente o maior desconto ser&aacute; aplicado na finaliza&ccedil;&atilde;o do
                                    pedido.
                                </p>
                            {% endif %}
                            </div>
                        {% endif %}

                        {% if productHelper.gifts() %}
                            <div class="pageProduct-gifts serverTray-content">
                                <p class="pageProduct-giftsText">BRINDE DO PRODUTO</p>
                                {{ productHelper.gifts() }}
                            </div>
                        {% endif %}

                        {% if product.is_kit %}
                            <div class="pageProduct-kit">
                                <div class="serverTray-content">{{ productHelper.kit() }}</div>
                                <div class="error-kit error-message" style="display: none">
                                    Por favor, selecione as varia&ccedil;&otilde;es antes de prosseguir.
                                </div>
                            </div>
                        {% endif %}

                        {% if product.additional_information %}
                        <div class="pageProduct-fieldsAdditional">
                            {{ product.additional_information }}
                            <div class="fieldsAdditional-required error-message" style="display: none">
                                Por favor, preencha os campos acima.
                            </div>
                        </div>
                        {% endif %}


                        <div class="pageProduct-buy serverTray-content" data-price-hidden="{{settings.hide_price ? 'true' : 'false'}}" data-buy-product="box">
                                <input class="buy-quantityTop u-show more" type="button" value="+" data-quantity />
                                <input class="buy-quantityDown u-show less" type="button" value="-" data-quantity />
                            {{ productHelper.form() }}
                        </div>

                    </form>
                    {% if settings.buttonWhatsApp_activeProduct %}
                        {% set phone2 = Translation('ag_telefone_2') %}
                        {% set link = phone2|replace({'(': '', ')': '', ' ':'', '-': ''}) %}
                        <div class="pageProduct-product__doubts">
                        <a target="_blank" href="https://api.whatsapp.com/send?l=pt&phone=55{{link}}&text=Oi, tudo bem? Gostaria de mais informa%C3%A7%C3%A3o sobre o Produto: {{ product.name }}, Link: {{ product.link }} e Valor: R$ {{product.price|currency }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="22" viewBox="0 0 20 22" fill="#fff" >
                                <path d="M6.99352 6.33068C7.17077 6.33793 7.36687 6.34623 7.55318 6.76038C7.68051 7.04351 7.89475 7.57133 8.06549 7.99196C8.1913 8.30192 8.29349 8.55368 8.31987 8.60644C8.38205 8.73081 8.42348 8.87603 8.34058 9.04211C8.32817 9.06693 8.31669 9.09036 8.30573 9.11275C8.24342 9.23991 8.19764 9.33335 8.09213 9.45683C8.05078 9.50511 8.00803 9.55712 7.96527 9.60912C7.87943 9.71354 7.79357 9.81797 7.71902 9.89236C7.59427 10.0163 7.4647 10.1511 7.60978 10.3998C7.75491 10.6488 8.25406 11.4629 8.99339 12.122C9.78763 12.8302 10.4776 13.1297 10.828 13.2818C10.8968 13.3117 10.9525 13.3359 10.9934 13.3564C11.2421 13.4807 11.3872 13.46 11.5323 13.2938C11.6774 13.1279 12.1537 12.5679 12.3196 12.3192C12.4854 12.0702 12.6512 12.1117 12.8792 12.1946C13.1072 12.2775 14.3299 12.8792 14.5786 13.0036C14.6271 13.0278 14.6724 13.0497 14.7145 13.07C14.8881 13.1538 15.0053 13.2103 15.0553 13.2938C15.1175 13.3978 15.1175 13.8955 14.9103 14.4762C14.703 15.0569 13.6876 15.617 13.2316 15.6585C13.1877 15.6624 13.1441 15.6676 13.0992 15.6729C12.6778 15.7224 12.1459 15.785 10.2472 15.0362C7.91084 14.1149 6.37038 11.8317 6.05212 11.36C6.02602 11.3213 6.00814 11.2948 5.99872 11.2823L5.99595 11.2786C5.86184 11.0994 4.9832 9.92512 4.9832 8.7101C4.9832 7.56477 5.54618 6.9644 5.80521 6.68817C5.82291 6.6693 5.8392 6.65193 5.85378 6.63601C6.08161 6.38713 6.35111 6.32485 6.5169 6.32485C6.52599 6.32485 6.53508 6.32485 6.54417 6.32485C6.70075 6.32483 6.85653 6.32481 6.99352 6.33068Z" fill="#fff" />
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M1.4257 15.8806C0.54217 14.3746 0.0803214 12.6678 0.0803214 10.9007C0.0803214 5.41877 4.55823 0.960938 10.0402 0.960938C12.7108 0.960938 15.2008 2.00511 17.0884 3.87258C18.9558 5.76013 20 8.25009 20 10.9208C20 16.4027 15.5221 20.8605 10.0402 20.8605C8.37349 20.8605 6.72691 20.4589 5.28113 19.6557L0 21.0413L1.4257 15.8806ZM3.03213 15.3184L3.23293 15.6196L2.38956 18.6718L5.52209 17.8485L5.82329 18.0292C7.08835 18.7923 8.55422 19.1939 10.0402 19.1939C14.5984 19.1939 18.3133 15.479 18.3133 10.9208C18.3133 8.71194 17.4498 6.62359 15.8835 5.05732C14.3373 3.51114 12.249 2.64768 10.0402 2.64768C5.48193 2.64768 1.76707 6.34246 1.76707 10.9208C1.76707 12.467 2.20883 13.9931 3.03213 15.3184Z" fill="#fff" />
                                <defs>
                                    <linearGradient
                                        id="paint0_linear_886_2164" x1="0" y1="11.0022" x2="20" y2="11.0022" gradientUnits="userSpaceOnUse">
                                        <stop stop-color="#20B038" />
                                        <stop offset="1" stop-color="#60D66A" />
                                    </linearGradient>
                                    <linearGradient id="paint1_linear_886_2164" x1="0" y1="11.0022" x2="20" y2="11.0022" gradientUnits="userSpaceOnUse">
                                        <stop stop-color="#20B038" />
                                        <stop offset="1" stop-color="#60D66A" />
                                    </linearGradient>
                                </defs>
                            </svg>
                            <span>{{ settings.buttonWhatsApp_activeProduct_text ? settings.buttonWhatsApp_activeProduct_text : "Dúvidas? Chama no Zap!" }}</span>
                        </a>
                        </div>
                    {% endif %}

                    {% if productHelper.shipping() %}
                        <div class="pageProduct-shipping" data-price-hidden="{{settings.hide_price ? 'true' : 'false'}}">
                            <span class="serverTray-content">{{ productHelper.shipping() }}</span>
                            <p class="shipping-text">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25" fill="none">
                                    <path d="M22.7815 12.6106L20.545 7.31904C20.4879 7.18241 20.3925 7.06582 20.2705 6.98383C20.1485 6.90183 20.0055 6.85804 19.8591 6.85792H17.6226V5.34603C17.6226 5.14554 17.5441 4.95327 17.4043 4.8115C17.2645 4.66973 17.0748 4.59009 16.8771 4.59009H2.71254C2.51482 4.59009 2.3252 4.66973 2.18539 4.8115C2.04558 4.95327 1.96704 5.14554 1.96704 5.34603V18.1971C1.96704 18.3976 2.04558 18.5898 2.18539 18.7316C2.3252 18.8734 2.51482 18.953 2.71254 18.953H4.30792C4.4796 19.5936 4.85438 20.1591 5.37444 20.5622C5.8945 20.9654 6.53094 21.1838 7.18557 21.1838C7.8402 21.1838 8.47663 20.9654 8.99669 20.5622C9.51675 20.1591 9.89153 19.5936 10.0632 18.953H14.745C14.9166 19.5936 15.2914 20.1591 15.8115 20.5622C16.3315 20.9654 16.968 21.1838 17.6226 21.1838C18.2772 21.1838 18.9137 20.9654 19.4337 20.5622C19.9538 20.1591 20.3286 19.5936 20.5003 18.953H22.0956C22.2934 18.953 22.483 18.8734 22.6228 18.7316C22.7626 18.5898 22.8411 18.3976 22.8411 18.1971V12.9055C22.8409 12.8041 22.8207 12.7039 22.7815 12.6106ZM17.6226 8.3698H19.3671L20.9625 12.1495H17.6226V8.3698ZM7.18557 19.7089C6.89067 19.7089 6.6024 19.6203 6.35721 19.4542C6.11201 19.288 5.92091 19.0519 5.80805 18.7756C5.6952 18.4994 5.66568 18.1954 5.72321 17.9021C5.78074 17.6088 5.92274 17.3394 6.13126 17.128C6.33979 16.9166 6.60546 16.7726 6.89468 16.7142C7.18391 16.6559 7.4837 16.6858 7.75615 16.8003C8.0286 16.9147 8.26146 17.1085 8.42529 17.3571C8.58913 17.6057 8.67657 17.898 8.67657 18.1971C8.67657 18.598 8.51948 18.9826 8.23987 19.2661C7.96025 19.5497 7.58101 19.7089 7.18557 19.7089ZM14.745 17.4411H10.0632C9.89153 16.8006 9.51675 16.2351 8.99669 15.8319C8.47663 15.4288 7.8402 15.2103 7.18557 15.2103C6.53094 15.2103 5.8945 15.4288 5.37444 15.8319C4.85438 16.2351 4.4796 16.8006 4.30792 17.4411H3.45805V6.10197H16.1316V15.5966C15.7921 15.7964 15.4949 16.0622 15.257 16.3787C15.019 16.6952 14.845 17.0563 14.745 17.4411ZM17.6226 19.7089C17.3277 19.7089 17.0395 19.6203 16.7943 19.4542C16.5491 19.288 16.358 19.0519 16.2451 18.7756C16.1323 18.4994 16.1027 18.1954 16.1603 17.9021C16.2178 17.6088 16.3598 17.3394 16.5683 17.128C16.7768 16.9166 17.0425 16.7726 17.3317 16.7142C17.621 16.6559 17.9208 16.6858 18.1932 16.8003C18.4656 16.9147 18.6985 17.1085 18.8623 17.3571C19.0262 17.6057 19.1136 17.898 19.1136 18.1971C19.1136 18.598 18.9565 18.9826 18.6769 19.2661C18.3973 19.5497 18.0181 19.7089 17.6226 19.7089ZM21.3501 17.4411H20.5003C20.3354 16.7937 19.9635 16.2199 19.4429 15.8096C18.9222 15.3992 18.2821 15.1755 17.6226 15.1733V13.6614H21.3501V17.4411Z" fill="#4B4B4B"/>
                                </svg>
                                Frete e Prazo de Entrega:</p>
                            <form class="shipping-form" data-shipping="form">
                                <label for="cep" class="shipping-label">CEP</label>
                                <input class="shipping-input mask-cep" id="cep" name="calcule o frete" type="text" minlength="9" maxlength="9" placeholder="Informe seu CEP" required />
                                <button type="submit" class="shipping-submit button2">Consultar</button>
                                <a href="https://buscacepinter.correios.com.br/app/endereco/index.php" rel="noopner" target="_blank" class="shipping-help">N&atilde;o sei meu CEP</a>
                            </form>
                            <div class="shipping-result loaded" data-shipping="result">
                                <p class="shipping-loading">Carregando fretes...</p>
                            </div>
                        </div>
                    {% endif %}

                {% else %}
                {# This helper verify if product is available or not and generate the correct html #}
                    <div class="pageProduct-outOfStock">
                        {% if product.variants and not product.upon_request %}
                            {{ productHelper.variants() }}
                        {% endif %}

                        {% set pricingWithEncode %}
                            {{ productHelper.pricing()
                                | replace({ 'botao-nao_indisponivel"' : 'botao-nao_indisponivel" data-unavailable = "Produto esgotado :("' })
                                | replace({ 'botao-sob-consulta\'' : 'botao-sob-consulta\' data-under-request = "Preencha o nosso formul&aacute;rio para consultar a disponibilidade deste produto."'})
                                | replace({ 'botao_tire_duvidas"' : 'botao_tire_duvidas" data-button-under-request = "Preencher formul&aacute;rio"' })
                            }}
                        {% endset %}
                        {{ pricingWithEncode }}
                    </div>
                {% endif %}
        </section>
    </div>
    {% if productHelper.bundle() %}
        <div class="pageProduct-buyTogether tray-hide">
            <div class="buyTogether serverTray-content">{{ productHelper.bundle() }}</div>
        </div>
    {% endif %}

    {% element 'snippets/product-tabs' { 'product' : product } %}

</div>
{% if settings.show_product_review %}
    <section class="pageProduct-comments" >
        {%- element 'product/comments' -%}
    </section>
{% endif %}

{% element 'snippets/product-related' { 'products_related': product.related_products } %}

{% if settings.history_position %}
    <section class="pageProduct-lastSeen">
        <h2 class="lastSeen-title">
            Produtos <strong>Visualizados</strong>
        </h2>

        <div class="lastSeen-list serverTray-content">
            {% element 'snippets/history' {
                'store.id'      : store.id,
                'pages.current' : pages.current,
                'category.id'   : category.id
            } %}
        </div>
    </section>
{% endif %}
